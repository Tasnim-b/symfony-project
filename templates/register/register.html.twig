<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - HealFit</title>
    <link rel="stylesheet" href="{{ asset('assets/styles/auth.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/styles/home.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body class="register-page scrollable">
    <!-- Arrière-plan avec le contenu de la home -->
    <div class="home-background">
        <!-- HEADER -->
        <header>
            <div class="container">
                <nav class="navbar">
                    <a href="{{ path('app_home') }}" class="logo">
                        <img src="{{ asset('assets/images/healFit-logo.png') }}" alt="HealFit Logo" class="logo-img">
                    </a>
                    <div class="nav-links">
                        <div class="topics-container">
                            <button class="topics-btn">
                                <i class="fas fa-heartbeat"></i> Health Topics
                            </button>
                        </div>
                        <div class="auth-buttons">
                            <a href="{{ path('app_login') }}" class="btn btn-login">Se connecter</a>
                            <a href="{{ path('app_register') }}" class="btn btn-signup active">S'inscrire</a>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- HERO -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>Transformez votre santé, améliorez votre vie</h1>
                    <p>Rejoignez la communauté HealFit...</p>
                    <button class="btn-hero">Commencer mon parcours</button>
                </div>
            </div>
        </section>

        <!-- Contenu simplifié -->
        <div class="home-sections">
            <div class="section-placeholder"></div>
            <div class="section-placeholder"></div>
            <div class="section-placeholder"></div>
        </div>

        <!-- FOOTER -->
        <footer>
            <div class="container">
                <div class="copyright">
                    <p>&copy; {{ "now"|date("Y") }} HealFit Wellness Studio. Tous droits réservés.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Overlay de flou -->
    <div class="blur-overlay"></div>

    <!-- MODAL D'INSCRIPTION -->
    <div class="auth-modal-container">
        <div class="auth-modal">
            <!-- Bouton de fermeture -->
            <a href="{{ path('app_home') }}" class="modal-close-btn">
                <i class="fas fa-times"></i>
            </a>

            <!-- En-tête avec logo -->
            <div class="auth-header">
                <div class="logo-container">
                    <img src="{{ asset('assets/images/healFit-logo.png') }}" alt="HealFit Logo" class="auth-logo">
                    <span class="auth-logo-text">HEALFIT</span>
                </div>
                <h1>Inscription</h1>
                <p>Rejoignez notre communauté et commencez votre parcours bien-être</p>
            </div>

            <!-- Flash Messages -->
            {% for message in app.flashes('success') %}
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i> {{ message }}
                </div>
            {% endfor %}

            {% for message in app.flashes('error') %}
                <div class="alert alert-error">
                    <i class="fas fa-exclamation-circle"></i> {{ message }}
                </div>
            {% endfor %}

            <!-- Formulaire d'Inscription -->
            {{ form_start(registrationForm, {
                'attr': {
                    'class': 'auth-form',
                    'id': 'registerForm',
                    'enctype': 'multipart/form-data'
                }
            }) }}

                {% if registrationForm.vars.submitted and not registrationForm.vars.valid %}

                    <div class="alert alert-error">
                        <ul>
                            {% for error in registrationForm.vars.errors %}
                                <li><i class="fas fa-exclamation-circle"></i> {{ error.message }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <!-- Champ Image de Profil -->
                <div class="form-group image-upload-group">
                    <label for="{{ registrationForm.profileImage.vars.id }}">
                        <i class="fas fa-image"></i> Photo de profil (optionnel)
                    </label>
                    <div class="image-upload-container">
                        <div class="image-preview" id="imagePreview">
                            <img src="" alt="Aperçu de l'image" class="preview-image">
                            <span class="preview-placeholder">
                                <i class="fas fa-user-circle"></i>
                                <span>Aucune image sélectionnée</span>
                            </span>
                        </div>
                        <div class="image-upload-controls">
                            <label for="{{ registrationForm.profileImage.vars.id }}" class="image-upload-btn">
                                <i class="fas fa-cloud-upload-alt"></i> Choisir une image
                            </label>
                            <button type="button" class="image-remove-btn" id="removeImageBtn" style="display: none;">
                                <i class="fas fa-trash-alt"></i> Supprimer
                            </button>
                            {{ form_widget(registrationForm.profileImage, {
                                'attr': {
                                    'class': 'image-input',
                                    'data-max-size': '5'
                                }
                            }) }}
                            <span class="file-info" id="fileInfo"></span>
                        </div>
                    </div>
                    {{ form_errors(registrationForm.profileImage) }}
                </div>

                <div class="form-group">
                    <label for="{{ registrationForm.fullName.vars.id }}">
                        <i class="fas fa-user"></i> Nom complet
                    </label>
                    {{ form_widget(registrationForm.fullName, {
                        'attr': {
                            'placeholder': 'John Doe'
                        }
                    }) }}
                    {{ form_errors(registrationForm.fullName) }}
                </div>

                <div class="form-group">
                    <label for="{{ registrationForm.email.vars.id }}">
                        <i class="fas fa-envelope"></i> Adresse Email
                    </label>
                    {{ form_widget(registrationForm.email, {
                        'attr': {
                            'placeholder': 'votre@email.com'
                        }
                    }) }}
                    {{ form_errors(registrationForm.email) }}
                </div>

                <div class="form-group">
                    <label for="{{ registrationForm.plainPassword.first.vars.id }}">
                        <i class="fas fa-lock"></i> Mot de passe
                    </label>
                    {{ form_widget(registrationForm.plainPassword.first, {
                        'attr': {
                            'placeholder': 'Créez un mot de passe'
                        }
                    }) }}
                    <div class="password-toggle">
                        <i class="fas fa-eye" id="toggleRegisterPassword"></i>
                    </div>
                    <small class="password-hint">Minimum 8 caractères avec majuscule, minuscule et chiffre</small>
                    {{ form_errors(registrationForm.plainPassword.first) }}
                </div>

                <div class="form-group">
                    <label for="{{ registrationForm.plainPassword.second.vars.id }}">
                        <i class="fas fa-lock"></i> Confirmer le mot de passe
                    </label>
                    {{ form_widget(registrationForm.plainPassword.second, {
                        'attr': {
                            'placeholder': 'Confirmez votre mot de passe'
                        }
                    }) }}
                    <div class="password-toggle">
                        <i class="fas fa-eye" id="toggleConfirmPassword"></i>
                    </div>
                    {{ form_errors(registrationForm.plainPassword.second) }}
                </div>

                <div class="form-options">
                    <label class="checkbox-container">
                        {{ form_widget(registrationForm.agreeTerms) }}
                        <span class="checkmark"></span>
                        J'accepte les <a href="#" class="terms-link">conditions d'utilisation</a> et la <a href="#" class="terms-link">politique de confidentialité</a>
                    </label>
                    {{ form_errors(registrationForm.agreeTerms) }}
                </div>

                {{ form_rest(registrationForm) }}

                <button type="submit" class="submit-btn register-submit">
                    <i class="fas fa-user-plus"></i> Créer mon compte
                </button>

                <div class="auth-switch">
                    <p>Vous avez déjà un compte ? <a href="{{ path('app_login') }}">Se connecter</a></p>
                </div>

            {{ form_end(registrationForm) }}
        </div>
    </div>

    <script src="{{ asset('js/auth.js') }}"></script>
    <script>
    // Animation à l'ouverture
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');

        // Toggle password
        document.getElementById('toggleRegisterPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('{{ registrationForm.plainPassword.first.vars.id }}');
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });

        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('{{ registrationForm.plainPassword.second.vars.id }}');
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });

        // Gestion de l'upload d'image
        const imageInput = document.getElementById('{{ registrationForm.profileImage.vars.id }}');
        const imagePreview = document.getElementById('imagePreview');
        const previewImage = imagePreview.querySelector('.preview-image');
        const previewPlaceholder = imagePreview.querySelector('.preview-placeholder');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const fileInfo = document.getElementById('fileInfo');

        if (imageInput) {
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Vérification de la taille (5MB max)
                    const maxSize = 5 * 1024 * 1024;
                    if (file.size > maxSize) {
                        alert('L\'image ne doit pas dépasser 5MB');
                        this.value = '';
                        return;
                    }

                    // Vérification du type de fichier
                    if (!file.type.match('image.*')) {
                        alert('Veuillez sélectionner une image valide');
                        this.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewImage.classList.add('loaded');
                        previewPlaceholder.style.display = 'none';
                        removeImageBtn.style.display = 'inline-flex';

                        // Afficher les infos du fichier
                        const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
                        fileInfo.textContent = `${file.name} (${sizeInMB} MB)`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Bouton de suppression d'image
            removeImageBtn.addEventListener('click', function() {
                imageInput.value = '';
                previewImage.src = '';
                previewImage.classList.remove('loaded');
                previewPlaceholder.style.display = 'flex';
                this.style.display = 'none';
                fileInfo.textContent = '';
            });
        }

        // Fermer avec la touche Échap
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.location.href = "{{ path('app_home') }}";
            }
        });

        // Fermer en cliquant sur l'overlay
        document.querySelector('.blur-overlay').addEventListener('click', function() {
            window.location.href = "{{ path('app_home') }}";
        });

        // Désactiver la validation JavaScript pour éviter les conflits avec Symfony
        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', function(e) {
                // Ne rien faire - laisser Symfony gérer la validation
                // Enlever toute validation JavaScript qui pourrait interférer
            });
        }
    });
</script>
</body>
</html>
